%p
  = form_for Reference.new, :remote => true, :id=>"reference_form" do |f|
    .field  
      = f.hidden_field :relationship_id, :value=>@relationship.id
    .field
      - if current_user
        = f.hidden_field :user_id, :value=>current_user.id 
    .field{:style=>"margin-left:5px;"}
      - if current_user      
        - @rel_owner = Digest::MD5.hexdigest(current_user.email).to_s
        %img.reference_gravatar{:src=> "http://www.gravatar.com/avatar/#{@rel_owner}?s=26&d=mm"}
      - else
        %img.reference_gravatar{:src=> "http://www.gravatar.com/avatar?s=26&d=mm"}              
      = f.text_field :reference_content, {:class=>"discussion_input", :placeholder=>"Please enter a valid URL &#8230;".html_safe}              
    .actions
      = f.submit 'Add Reference', :class=>"discussion_submit", :id=>"reference_collector", :style=>"margin:0px;"
          
  %div{:style => "clear:both"}

%div{:id=>"error_container"}
  %div{:style=>"float:right;width:15px;"}
    %a{:href=>'#', :class=>'closebutton'}
      %img{:border =>'0', :src=>'/images/system/close.png', :alt=>'close button', :width=>'15', :height=>'15'}
  %div{:id=>"error"}
    -if Reference.new.errors.any?
      = Reference.new.errors.full_messages.join("\n")
  %div{:style=>"clear:both;"} 

- if @notice
  .reference_container
    .reference_error
    .reference_error_text
      = @notice
    %div{:style=>"clear:both;"}  
- @relationship.references.reverse.each do |reference|
  .reference_container
    - if reference.user
      - @submitter_avatar = Digest::MD5.hexdigest(reference.user.email).to_s
      %img.reference_gravatar{:src=> "http://www.gravatar.com/avatar/#{@submitter_avatar}?s=26&d=mm"}          
    - else
      %img.reference_gravatar{:src=> "http://www.gravatar.com/avatar?s=26&d=mm"} 
    .reference_text{:style=>"float:left;margin-left:5px;"}  
      %a{:href=>"#{reference.reference_content}", :target=>"_blank"}>= reference.reference_content
      %br
        %span.reference_owner
          - if reference.user
            %a{:href=>"/users/#{reference.user.id}"}>= reference.user.username
          - else
            Anonymous user

        %span.date_time
          = time_ago_in_words(reference.created_at) + ' ago'

    %div{:style => "clear:both"}
- content_for(:include_custom_stylesheet) do
  = stylesheet_link_tag "styles"



- content_for(:title, @user.username+"'s "+"Issues")

#contentwrapper

  .contentmain
    .profile_stats_container
      %div{:class=>"formheading", :style=>"background:#f5f5f5; margin-bottom:-25px; z-index:400; position:relative;"}
        %div{:class => "username"} 
          = @user.username
      
      %div{:style=>"float:right; margin:15px 0px -25px 0px;"}
        - form_tag user_path, :id=>"search_form", :method => 'get' do 
          %div{:class=>"search_button"}
            %div{:style=>"float:left;display:table-cell; vertical-align:middle"}
              = text_field_tag :search, params[:search], :align=>"top", :placeholder => "#{@user.username}'s issues. . .", :autocomplete=>"off", :class=>"searchfield_small"
            %div{:style=>"float:left;"}
              
              = submit_tag "Search", :name => nil, :class=>"srch_button"
            %div{:style=>"clear:both"} 
              
    
      %div{:class=>"formcontentdiv", :style=>"border-color:#f5f5f5; float:left; padding-left:10px; width:366px;"}
        %div{:style=>"float:left;"}
          - @hash = Digest::MD5.hexdigest(@user.email).to_s
          %img{:src=> "http://www.gravatar.com/avatar/#{@hash}?s=128&d=mm", :class=>"gravatar", :style=>"margin-top:5px;"}
          %div{:class => "reputation_block"}
            = @user.reputation
          %div{:class => "reputation_block", :style=>"color:#bebebe;font-size:18px;margin-top:-15px;"}
            reputation   
    
        %div{:style=>"float:left;padding-top:10px"}
          %div{:class=>"profile_stats_label"}
            Issues created
          %div{:class=>"profile_stats_value"}  
            = Version.find(:all, :conditions=>['item_type=? AND event=? AND whodunnit=? AND reverted_from IS ?', 'Issue', 'create', @user.id, nil]).map(&:item_id).uniq.count
          %div{:class=>"profile_stats_label"}
            Issues removed
          %div{:class=>"profile_stats_value"}  
            = Version.find(:all, :conditions=>['item_type=? AND event=? AND whodunnit=? AND reverted_from IS ?', 'Issue', 'destroy', @user.id, nil]).map(&:item_id).uniq.count
          %div{:class=>"profile_stats_label"}
            Current issues
          %div{:class=>"profile_stats_value"}  
            = @user.issues.count
          %div{:class=>"profile_stats_label"}
            Relations connected
          %div{:class=>"profile_stats_value"}  
            = Version.find(:all, :conditions=>['item_type=? AND event=? AND whodunnit=? AND reverted_from IS ?', 'Relationship', 'create', @user.id, nil]).map(&:item_id).uniq.count
          %div{:class=>"profile_stats_label"}
            Relations deleted
          %div{:class=>"profile_stats_value"}  
            = Version.find(:all, :conditions=>['item_type=? AND event=? AND whodunnit=? AND reverted_from IS ?', 'Relationship', 'destroy', @user.id, nil]).map(&:item_id).uniq.count
          %div{:class=>"profile_stats_label"}
            Current relations
          %div{:class=>"profile_stats_value"}  
            = @user.relationships.count
          %div{:class=>"profile_stats_label"}
            References
          %div{:class=>"profile_stats_value"}  
            = @user.references.count  
        %div{:style=>"clear:both;"}
      
      %div{:style=>"float:right; margin-top:40px; width:660px;"}    
        %div{:class => "formheading_small", :style=>"margin-left:0px;background:#f5f5f5;color:#858585;"}
          Contribution
          %span{:id=>"wait_for_more"}
        %div{:id=>"activities"}
          = render 'activities'
        - if @activities.count > 0
          %div{:id=>"more", :style=>"height:15px;font-size:12px;text-align:center;border-bottom: 1px solid whiteSmoke;border-left: 1px solid whiteSmoke;border-right: 1px solid whiteSmoke;font-weight:bold;", :title=>"More contributions"} More... 
    
      %div{:style=>"clear:both;"}

    
    %div{:id=>"issues"}
      = render 'issues'

        
#clear{:style => "clear:left;"}

#confirm_popup
  #confirm_title{:class=>"formheading_small"}
  .formcontentdiv_small
    #confirm_wait{:style=>"margin:-42px 0px 0px 0px;float:right;background-color:#ffffff;"}  
    #confirm_msg
    #confirm_buttons{:style=>"margin-top:10px; text-align:center"}
      %input#confirm_yes{:type => "button", :value => "Delete", :class=>"wiki_button", :style=>"padding-left:5px;background-image:none;"}
      %input#confirm_cancel{:type => "button", :value => "Cancel", :class=>"wiki_button", :style=>"padding-left:5px;background-image:none;"}



%script{:src => "http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css", :type => "text/javascript"}
%script{:src => "http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js", :type => "text/javascript"}
%script{:src => "http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js", :type => "text/javascript"}
%script{:type => "text/javascript"}

  // Make sure the DOM is loaded
  $(document).ready(function(){
  
  window.confirm = false;

  // D I S M I S S    T H E    F L A S H    N O T I C E
  if ($('#notice').html().trim()) {
  $("#notice_container").effect("bounce", { times:3 }, 200);
  $('#notice').css({display : 'block'});
  }
  
  $("#notice_container a.closebutton").click(function(){
  $("#notice_container").slideUp(100);
  });

  // D E L E T E     C O N F I R M A T I O N
  var href_carrier = '';
  var bubble_to_remove = '';
        
  $(".del-issue").live('click', function(e) {
  e.preventDefault();
  var title = $(this).data('title');
  var msg = $(this).data('confirm');
  href_carrier = $(this).attr('href');
  bubble_to_remove = $(this).parents(".issue_container");
  showPopup(title, msg);
  return false;
  });

  $("#confirm_yes").click(function() {
  /$("#confirm_popup").fadeOut('slow');
  $("#confirm_wait").html('<img border="0" src="/images/system/spinner.gif"/>');
  $.ajax({
  type: "DELETE",
  url: href_carrier,
  cache: false,
  success: function(){
  bubble_to_remove.slideUp(400);
  bubble_to_remove = '';
  $("#confirm_msg").html('Issue Deleted!'); 
  $("#confirm_buttons").hide(); 
  $("#confirm_wait").empty();
  $("#confirm_popup").delay(2000).fadeOut('slow', function(){
  $('#fade').delay(2000).remove();
  });
  
  }
  });  
  /location.href = href_carrier;
  });
    
  $("#confirm_cancel").click(function() {
  $('#fade').remove();
  $("#confirm_popup").fadeOut('slow');    
  href_carrier = '';
  });

  

  $("div#more").attr("segment",2);
  $("div#more").click(function(){
  
  $(this).hide();
  $("#wait_for_more").html('<img src="/images/system/spinner.gif" style="max-height:14px;"/>');

  $.ajax({url: document.location.href, data: {segment: $(this).attr("segment")},success: function(data){
  $("div#more").attr("segment", parseInt($("div#more").attr("segment"))+1);
  $("div#more").show();
  $("#wait_for_more").empty();
  }});

  return false;
  });

  });   //  E N D    O F    D O M    L O A D 

  function showPopup(title, msg) {
  $("#confirm_title").html(title);
  $("#confirm_msg").html(msg);
  $("#confirm_buttons").show();
  $('body').append('<div id="fade"></div>'); //Add the fade layer to bottom of the body tag.
  $('#fade').css({'filter' : 'alpha(opacity=80)'}).fadeIn(); //Fade in the fade layer - .css({'filter' : 'alpha(opacity=80)'}) is used to fix the IE Bug on fading transparencies   
  $("#confirm_popup").fadeIn('slow');
  }   
 
